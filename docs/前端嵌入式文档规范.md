# 前端嵌入式文档规范

本文档用于约束“贴近代码的文档”如何在前端工程内落地，目标是让阅读者无需跳出代码即可理解模块边界、公共 API 与关键约束，同时避免长文散落在业务实现文件中导致难以维护。

## 1. 适用范围

- 适用于：`src/**/*.{ts,tsx,vue}`（前端代码）。
- 不适用于：`src-tauri/**`（Rust 侧请遵循 Rustdoc 与 `docs/code-conventions.md` 的约定）。

## 2. 文档分层与放置位置

前端“嵌入式文档”分为 3 层，分别解决不同问题：

### 2.1 目录级（类比 Java 的 package-info.java）

**推荐形式：目录内 `README.md`（短文档）**

- 放置位置：模块根目录，例如：
  - `src/features/plugins/README.md`
  - `src/features/plugins/presentation/store/README.md`
- 适用内容（目录层级的“约束/边界”）：
  - 该目录的职责与边界（做什么/不做什么）
  - 子目录分层说明（data/domain/di/presentation/mock）
  - 依赖方向约束（例如 presentation 不能反向依赖 data 实现细节）
  - 与 `docs/`、`docs/design/` 的关联入口链接

**约束：**

- 目录内 `README.md` 必须“短而硬”，仅保留与该目录强相关、且会随代码变更而更新的内容。
- 超过 2 屏的长文档，必须迁移到 `docs/`（并在 README 中只保留入口链接）。

### 2.2 模块级（公共入口与导出约束）

**推荐形式：`index.ts` 作为公共入口（强烈推荐）**

- 放置位置：需要“对外被引用”的目录，例如：
  - `src/features/plugins/presentation/store/index.ts`
  - `src/features/servers/presentation/store/index.ts`
  - `src/shared/net/http/index.ts`（若存在大量对外工具）

**职责：**

- 收敛导入路径：跨目录引用优先从 `index.ts` 导入，避免深层路径耦合（例如 `.../store/fooStore`）。
- 描述“对外 API 面”：在文件头注释中明确：
  - 允许被外部依赖的导出项
  - 禁止外部直接导入的内部文件（如实现细节）
  - 可能的初始化顺序/副作用（如 store 单例缓存）

**约束：**

- `index.ts` 只做“导出与说明”，不要在其中写业务逻辑。
- 避免在 `index.ts` 引入会触发副作用的模块（例如启动网络连接、注册全局事件），以免产生隐式初始化。

### 2.3 符号级（函数/类型/常量/组件）

**推荐形式：TSDoc / JSDoc（结构化注释）**

- 适用对象：
  - `export` 的函数、类型、常量
  - 关键 private helper（特别是协议/存储/加密/状态机相关）
- 写法要求：
  - 遵循 `docs/日志与注释规范.md` 与 `docs/code-conventions.md`
  - 导出函数必须包含 `@param`，有返回值则必须包含 `@returns`

## 3. 导入路径规范（配合 index.ts 使用）

### 3.1 基本原则

- 同目录内部：允许相互深层引用（为了实现便利）。
- 跨目录引用：优先通过该目录的 `index.ts` 入口引用，降低耦合。

### 3.2 允许的例外

以下情况允许绕过 `index.ts` 深层引用（但必须写清楚原因）：

- 避免循环依赖（例如 store index 引用某个实现会反向依赖 presentation）
- 仅用于测试或 mock
- 仅用于临时迁移期（需要在 TODO 中标明迁移目标与删除时机）

## 4. 推荐模板

### 4.1 目录 README.md 模板（推荐）

```md
# <模块名>

## 职责

- ...

## 目录结构

- `data/`：...
- `domain/`：...
- `di/`：...
- `presentation/`：...

## 依赖约束

- ...

## 相关文档

- `docs/...`
```

### 4.2 index.ts 文件头模板（推荐）

```ts
/**
 * @fileoverview <目录公共入口>
 * @description <对外导出范围 + 禁止深层导入说明 + 迁移策略>
 */
```

## 5. 与仓库长期文档的关系

- `docs/`：存放长期维护的架构/协议/规范文档（可作为“权威说明”）。
- `src/**/README.md` 与 `index.ts`：存放贴近代码的“边界与入口说明”（可作为“快速上手与导航”）。

