# 04｜页面规格：登录与服务器

> 说明：该方案已废弃，现行方案为 `docs/ui/方案A-插线板/文档索引.md`。

版本：v1.1  
日期：2026-01-31  
范围：登录页 + 服务器管理/信息弹窗 + 连接失败与 required gate

## 1. 登录页（/）

现有实现：`src/features/auth/presentation/pages/LoginPage.vue`

结构：
- 左：品牌面板（解释产品、提示 Enter 登录、展示技术栈 Chip）
- 右：登录表单（server_socket + server_ecc_public_key + email + code）

交互规格：
- 验证码：
  - 未填邮箱 → 只提示邮箱非法（不请求服务端）。
  - 发送成功 → 60s 倒计时（现有实现已覆盖）。
- 登录：
  - 必须先 `ensureConnected()`（握手/切换 server）
  - 成功后进入 `/chat`

错误展示（PRD 7.3）建议分层（UI 文案可以更具体）：
- socket 缺失 / ecc 缺失：表单内提示（不要 toast 抢焦点）
- 握手失败：toast + “编辑服务器/重试”引导（建议在页面内增加可操作区域）

## 2. required 插件 gate（从登录页触发）

触发条件：
- 登录相关 API 返回 `reason="required_plugin_missing"`（详见 `design/protocol/PLUGIN-CATALOG-AND-ERRORS.md`）

UI 口径：
- 登录页顶部出现“阻止登录”的说明条（非错误语气），按钮：`去安装 required 插件`。
- 自动跳转：也可直接路由到 `/required-setup`（推荐，减少用户理解成本）。

## 3. 服务器管理（Modal）

现有实现：
- 服务器管理：`src/features/servers/presentation/components/modals/ServerManagerModal.vue`
- 服务器信息：`src/features/servers/presentation/components/modals/ServerInfoModal.vue`

设计规格（补齐 PRD 7.3）：
- 连接失败原因的“可解释性”
  - 网络不可达 / 握手失败 / 版本不兼容 / 公钥校验失败（若启用）应映射为不同文案与建议动作。
- 服务器卡片内增加两个轻量状态：
  - `connected`（当前连接）/ `lastSeen`（可选，后续）

## 4. Login 与 Server 的视觉细节

- server_socket 输入：使用 mono 字体更易读（可在输入框内部针对该字段增加 `font-family: var(--cp-font-mono)`）。
- ECC key：建议默认折叠显示（“显示/隐藏”），避免长 key 影响布局（可后续实现）。
