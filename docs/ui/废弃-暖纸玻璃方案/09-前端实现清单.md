# 09｜前端实现清单（按 PRD 补齐 UI）

> 说明：该方案已废弃，现行方案为 `docs/ui/方案A-插线板/文档索引.md`。

版本：v1.1  
日期：2026-01-31  
目标：把“要做什么 UI”变成“要改哪些文件/新增哪些文件/新增哪些 i18n key”。

> 说明：本清单是 UI 侧落地指导，不强制一次性完成；但 P0（required gate / 未知 domain 降级 / 关键异常）应优先。

## 1. 目录建议（与现有分层一致）

新增（建议）：

- `src/features/plugins/presentation/pages/PluginCenterPage.vue`
- `src/features/plugins/presentation/pages/PluginDetailPage.vue`
- `src/features/plugins/presentation/components/*.vue`（卡片、badge、进度、筛选）
- `src/features/plugins/presentation/store/*`（catalog/install state machine）
- `src/features/auth/presentation/pages/RequiredSetupPage.vue`
- `src/features/chat/presentation/components/messages/UnknownDomainBubble.vue`

并在 `src/app/router.ts` 增加对应路由：

```ts
{ path: "/plugins", component: () => import("../features/plugins/presentation/pages/PluginCenterPage.vue") }
{ path: "/plugins/detail/:pluginId", component: () => import("../features/plugins/presentation/pages/PluginDetailPage.vue") }
{ path: "/required-setup", component: () => import("../features/auth/presentation/pages/RequiredSetupPage.vue") }
```

## 2. required gate（登录联动）

UI 需要的输入（来自服务端错误）：
- `reason="required_plugin_missing"`
- `missing_plugins[]`

落地点（建议）：
- 登录相关 service（捕获错误并识别 reason）
- 登录页在识别到 required gate 时 `router.replace("/required-setup")`

## 3. 插件中心（状态机 UI）

实现最小闭环需要的数据与状态：

- `server_id`（缺失则插件中心禁用，见 `design/client/PLUGIN-CENTER-FLOWS.md` 2.2）
- Catalog：
  - server catalog：`plugins[]` + `required_plugins[]`
  - repo catalog（可选）
- 本地安装态（按 server_id）：
  - `installedVersions[]`
  - `currentVersion?`
  - `enabled`
  - `status: ok|disabled|failed`
  - `lastError?`
  - `installedFrom: server|repo`

UI 关键点：
- 任何失败都必须“可见原因 + 可重试”。
- 更新必须“原子切换 + 失败回滚”的结果可见（哪一版在用）。

## 4. 未知 domain 消息降级

消息渲染层需要的字段（PRD 6.1 / 6.3）：
- `domain`、`domain_version`、`data`、`preview?`

渲染规则（PRD 7.2）：
- 若命中已注册 renderer：正常渲染
- 否则：
  - `preview` 有 → 渲染 `preview` 文本 + “安装插件”按钮
  - `preview` 无 → 渲染提示卡（不展示 `data`）

入口联动：
- 点击“安装插件” → 跳转 `/plugins` 并带 query：

```txt
/plugins?focus_plugin_id=<plugin_id>&filter=required|all
```

## 5. i18n Key（建议新增）

根据现有 `src/app/i18n/messages/zh_cn.ts` / `en_us.ts` 的结构，新增建议：

- 插件中心：
  - `plugin_center`、`plugin_install`、`plugin_enable`、`plugin_disable`
  - `plugin_update`、`plugin_uninstall`、`plugin_required`
  - `plugin_install_step_downloading`、`plugin_install_step_verifying`、`plugin_install_step_unpacking`
- required 向导：
  - `required_setup_title`、`required_setup_desc`
  - `required_missing_list`、`required_go_install`
- 降级消息：
  - `unknown_domain`、`unknown_domain_preview_missing`、`install_plugin_to_view`

## 6. UI Token（建议补齐）

如果要补齐状态色（success/warn/info），建议在 `src/App.vue` 的 `:root` 增加本目录 `02-设计系统与Token.md` 的新增 token，并同步覆盖部分 `--td-*`（可选）。
