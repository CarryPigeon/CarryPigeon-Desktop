# 05｜页面规格：聊天与消息渲染（Patchbay）

版本：v1.0  
日期：2026-01-31

## 1. 消息气泡（以 domain 为第一视觉线索）

每条消息左侧有 2px “Signal Strip”，颜色来自 domain：
- Core:Text → `--cp-domain-core`
- Unknown → `--cp-domain-unknown`

头像（新增/强制）：
- 在 **频道内消息流**（SignalPane / MessageList）中展示发送者头像（圆形 28–32px）。
- 头像用于“快速识别说话者”，不应抢占 domain 信号条的优先级：
  - 建议布局：`Avatar` + `Signal Strip(2px)` + `Bubble`
  - 分组折叠时可仅在组首展示头像（后续同作者消息可隐藏头像以降低噪声）。

气泡结构：
- Meta：头像/用户名/时间（可分组折叠）
- Body：渲染内容（Core 文本或插件 renderer）
- Actions：右键菜单（复制/回复/删除/转发）

## 2. 未知 domain 降级（PRD 7.2）

规则：
- 优先显示 `preview`
- 无 preview：显示 “需要插件以解码此信号” 的卡片（不展示 raw data）
- 提供入口：`安装插件` → `/plugins?focus_plugin_id=...`

视觉表达（差异化）：
- 卡片标题：`UNPATCHED SIGNAL`
- domain 与 version 以铭牌形式展示（mono）
- 一根“断开的虚线线缆”作为装饰（可选）

## 3. 回复（reply_to_mid）与 Composer Host

Composer Host 结构（与 `design/plugin/PLUGIN-COMPOSER-UI.md` 对齐）：
- 左：Domain Selector（Core + 插件 domain）
- 中：输入区（Text 或插件 composer slot）
- 上：Reply Bar（显示被引用消息摘要 + 取消按钮）
- 右：Send（发送）+ 状态（sending/error）

失败策略：
- 发送失败：保留草稿 + 提示错误 + 允许重试（不静默吞错）

## 4. 删除=消失（PRD 6.2）

删除动作在 UI 上分两类（名称要清晰）：
- “删除”（硬删除）：删除后消息直接从列表消失
- “撤回”（若服务端概念存在）：等价于删除但可受权限/时间窗口影响（若没有该概念则不展示）

无论哪种：
- 成功：消息立刻移除
- 失败：显示 toast + 可重试（若本地已移除需回滚显示或提示“删除未成功”并刷新历史）
