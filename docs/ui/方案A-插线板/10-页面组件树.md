# 10｜页面组件树（Patchbay 落地视角）

版本：v1.0  
日期：2026-01-31

> 目标：把“页面长什么样”进一步落到“Vue 组件树 + Props/Emits + Store 依赖”，便于直接开工。

## 1. 路由清单（建议）

- `/`：登录（Handshake + Auth）
- `/chat`：主界面（Racks/Channels/Signals/Composer/Ports）
- `/plugins`：插件中心（Module Rack）
- `/plugins/detail/:pluginId`：插件详情（可做为 Drawer，也可独立页）
- `/required-setup`：必需插件向导（Power Latch Open）

> 子窗口/Popover 继续沿用现有模式（`src/main.ts` query 分发），不在此处重复。

## 2. `/` 登录页（Patchbay Login）

```text
LoginPage
├─ RackOverviewPanel
│  ├─ MonoTag(server_socket)
│  ├─ TransportSelect(TLS Strict/TLS Insecure/TCP)
│  └─ ConnectionPill(state, detail, retry)
└─ AuthPanel
   ├─ EmailField
   ├─ CodeField + SendCodeButton(countdown)
   ├─ PrimaryButton(Login)
   └─ InlineErrorBanner(optional)
```

关键 props/emits：
- `ConnectionPill`：`state: connected|reconnecting|offline`，`detail?: string`，`onRetry?: () => void`
- `SecretField`：`modelValue` / `update:modelValue`，`reveal` toggle

Store 依赖（现有 + 建议新增）：
- 现有：`currentServerSocket`、server list store（已在 `ServerManagerModal` 有）
- 新增：`useConnectionStore()`（暴露 handshake 状态与失败原因）

## 3. `/chat` 主界面（Patchbay Main）

```text
MainPage
├─ ServerRail
│  ├─ RackList
│  │  └─ RackItem* (LED + icon)
│  └─ RailMenuButton (server manager / plugins / about)
├─ ChannelRail
│  ├─ PatchPanelHeader (server name + socket + lock status)
│  ├─ ChannelSearch
│  └─ ChannelPortList
│     └─ ChannelPortItem* (port dot + name + unread)
├─ TopConsole
│  ├─ GlobalSearch (Ctrl/Cmd+K)
│  └─ ConnectionPill
├─ SignalPane
│  └─ MessageList
│     ├─ DaySeparator*
│     └─ MessageRow*
│        ├─ SignalStrip(domainColor)
│        └─ MessageBody
│           ├─ CoreTextBubble | PluginRendererBubble | UnknownDomainCard
│           └─ MessageContextMenu (copy/reply/delete/forward)
├─ ComposerPane
│  └─ ComposerHost
│     ├─ ReplyBar(optional)
│     ├─ DomainSelector
│     ├─ ComposerSlot (CoreTextComposer | PluginComposer)
│     └─ SendButton + SendState
└─ MembersRail
   └─ MemberPortList
      └─ MemberPortItem* (avatar + status) + MemberContextMenu
```

现有组件可复用（建议逐步改造样式）：
- ServerRail：`src/features/servers/presentation/components/lists/ServerList.vue`
- ChannelRail：`src/features/channels/presentation/components/lists/ChannelList.vue`
- MessageList：`ChatBox.vue` + `MessageBubbleComponents.vue`
- CoreTextComposer：现有 `TextArea.vue`

建议新增的“最小 Patchbay 组件”（不必一口气全做）：
- `SignalStrip`、`UnknownDomainCard`、`ConnectionPill`、`ComposerHost`、`DomainSelector`

## 4. `/plugins` 插件中心（Module Rack）

```text
PluginCenterPage
├─ ModuleFilters
│  ├─ SearchField
│  ├─ Segmented(Filter: all/installed/enabled/failed/updates/required)
│  └─ SourceSelect(server/repo)
├─ ModuleGrid
│  └─ ModuleCard*
│     ├─ ModuleTitle(name + version)
│     ├─ MonoTag(plugin_id)
│     ├─ DomainPorts(provides)
│     ├─ StatusBadges(required/update/failed)
│     └─ Actions(install/enable/disable/update/uninstall/detail)
└─ ModuleDetailDrawer (可选：点击卡片打开)
   ├─ PermissionsPanel(diff highlight)
   ├─ SourcePanel(sha256)
   ├─ DomainsPanel(contracts)
   ├─ ErrorPanel(lastError)
   └─ VersionSwitcher(currentVersion / installedVersions)
```

Store 依赖（建议新增）：
- `usePluginCatalogStore(server_id)`
- `usePluginInstallStore(server_id)`（安装/启用/更新/回滚状态机）

## 5. `/required-setup` 必需插件向导（Power Latch）

```text
RequiredSetupPage
├─ PowerLatchBanner (blocked reason)
├─ RequiredChecklist
│  └─ RequiredItem*
│     ├─ plugin_id + name + status
│     ├─ quick actions (install/enable/retry/rollback/detail)
│     └─ lastError (collapsed)
└─ FooterActions
   ├─ OpenPluginCenter(required filter)
   ├─ Recheck
   └─ SwitchServer
```

数据依赖：
- `missing_plugins[]`（来自服务端错误 payload）
- 本地安装态（按 `server_id`）：enabled/status/currentVersion/lastError
