# 04｜页面规格：登录与连接（Patchbay）

版本：v1.0  
日期：2026-01-31

## 1. 登录页布局（双面板）

- 左：Rack Overview（机柜概览）
  - 显示当前将连接的 server_socket（mono 字体）
  - 显示 TLS 状态（Strict/Untrusted/Trusted）
  - 显示必需插件门禁状态（若已知）
- 右：Auth Panel（验证码登录）

差异化点：
- 把“握手/连接”作为独立阶段展示：`Handshake → Verify → Auth`（避免用户把所有失败都理解成“验证码错了”）。

## 2. required gate 分支（阻止但不挫败）

触发：登录 API 返回 `required_plugin_missing`（含 `missing_plugins[]`）。

行为：
- 立即切换到 `/required-setup`
- 并在顶部留一个返回入口：`返回服务器编辑`

## 3. 连接失败原因分层（PRD 7.3）

UI 必须把失败分为可操作的几类（文案 + 按钮）：

- Network Unreachable：`检查地址/网络` → 按钮：编辑服务器、重试
- Handshake Failed：`协议/兼容性` → 按钮：查看详情、重试
- Version Incompatible：`升级客户端/服务端` → 按钮：打开关于、复制版本信息
- TLS Verify Failed：`证书校验失败` → 按钮：查看证书、信任并继续（显式确认）、取消连接

## 4. 连接状态组件（统一入口）

建议复用同一组件：
- `ConnectionPill`：绿/琥珀/红三态 + 简短文案 + 可选“重试”按钮
- 登录页、主界面顶栏都用同一组件，保证一致性。

## 5. TLS 信任体验（自建服务器场景）

自建服务器常见两类：
- 有公网域名 + 可信证书（推荐）：Strict 模式即可。
- 自签名/内网证书：需要“信任策略”（不要让用户被迫关掉安全校验）。

建议最小 UX（TOFU 可选）：
- Strict（默认）：校验证书链 + 主机名；失败则阻止并给出“查看证书/复制指纹”。
- Trust Fingerprint（可选）：用户确认指纹后，按 `server_socket` 固定 pin（后续不一致则阻止）。
- Insecure（仅开发）：允许无效证书/主机名（必须二次确认并用醒目的风险文案）。

