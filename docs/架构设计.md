# 架构设计（精简版）

## 1. 架构目标

- 采用 **Feature-first + Clean Layers**，支持长期演进（尤其插件化）。
- 让“业务规则、平台边界、UI 编排”清晰分离，降低耦合与回归成本。

## 2. 目录与职责

- `src/features/<feature>/`
  - `domain/`：业务模型、ports、usecases（不依赖 Vue/Tauri）
  - `data/`：IO 与适配器实现（HTTP/Tauri/Storage）
  - `presentation/`：页面、组件、store
  - `di/`：组装入口（实现选择与注入）
  - `mock/`、`test/`：按需
- `src/shared/`：跨 feature 通用能力（不放业务规则）
- `src/app/`：应用级编排（启动、路由、bridge）

## 3. 依赖规则（必须）

- feature 内：`presentation -> di -> domain <- data`。
- `domain` 禁止依赖 `data/presentation/di`、Vue、Tauri、浏览器 API。
- 跨 feature 禁止直连内部实现，仅通过 `@/features/<feature>/api` 或 `shared`。

## 4. 运行模式

运行时配置真源：`src/shared/config/runtime.ts`

- `off`：真实链路
- `store`：内存 mock（UI 预览）
- `protocol`：协议级 mock（HTTP/WS，不访问真实网络）

统一选择器：`src/shared/config/mockModeSelector.ts`

## 5. 平台边界

- Tauri 命令/事件集中在 `src/shared/tauri/*`。
- Rust 命令错误统一、返回模型统一、日志 action 统一（见 `docs/Rust统一标准.md`）。

## 6. 插件架构要点

- 插件目录（catalog）是服务端能力；安装/启停/切换是客户端生命周期能力。
- 插件通过受控 Host API 与宿主交互，不直接操作宿主内部状态。
- 详细设计见：`docs/design/README.md`。
