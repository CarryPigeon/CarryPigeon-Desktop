# ADR-0001：插件作用域与 Required Gate

日期：2026-01-31  
状态：Accepted

## 背景

项目定位为“自建服务器聊天客户端 + 插件生态”，需要明确插件隔离边界与 required 插件生效机制。

## 决策

1) 插件作用域是**服务器级**：
- 同一服务器下所有频道共享同一套插件。
- 客户端本地安装/版本/缓存隔离键统一使用 `server_id`（服务端返回固定 UUID）。

2) 频道不声明插件约束：
- 不存在 channel required。
- 未安装某 domain 插件时，频道仍可进入，消息按降级策略展示。

3) 服务端可声明 **server required 插件**，未满足时阻止登录：
- 允许：握手、拉取服务器信息、拉取插件目录、下载/安装/启用插件。
- 禁止：注册/登录/token-login 等登录相关能力。

## 影响

- 客户端必须在登录前执行 required 检查与安装引导。
- 服务端必须返回稳定可识别的 required 错误信息。

## 迁移/兼容

- 后续引入签名/信任体系时，不改变本 ADR 的作用域与 gate 语义。
