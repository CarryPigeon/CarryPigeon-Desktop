# 客户端插件安装与更新（草案）

范围：客户端如何从“服务器目录/仓库目录”获取插件信息，下载插件包，校验并安装到本地（按 server_socket 隔离）。

## 1. 来源
- Server Catalog：服务端返回插件列表与 required 插件。
- Repo Catalog：用户可配置仓库源，浏览与安装插件。

## 2. 完整性与缓存（P0）
- 下载后必须校验 `sha256`。
- 本地缓存路径按 `server_id`（服务端返回固定 UUID）分区。
- 插件运行时从本地静态资源协议加载（例如 `app://`），不依赖在线远端加载。

补充：插件包结构与本地目录布局见 `design/client/PLUGIN-PACKAGE-STRUCTURE.md`。

## 3. 更新策略（P1）
### 3.1 P0：检查更新（用户确认）
宿主支持：
- “检查更新”：对已安装插件查询 server catalog / repo catalog 的最新版本；
- “用户确认后更新”：展示版本差异与权限变化（若有）→ 用户确认 → 下载 → sha256 校验 → 替换安装 → 重新 enable。

最低要求：
- 更新前检查 `min_host_version`；
- 更新失败可回滚到旧版本（至少保留旧包直到新包 enable 成功）。

### 3.2 P1：自动更新/回滚策略（规划）
- 自动更新策略与回滚策略可后续完善。
