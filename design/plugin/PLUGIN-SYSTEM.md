# 插件系统总览（客户端 + 服务端）

目标：让核心包提供稳定的频道群聊基座；所有垂直能力（消息类型、渲染、输入、校验、索引、绑定外部账号等）通过插件扩展。

## 范围
- 插件类型
  - 客户端插件：渲染器（renderer）、输入器（composer）、本地能力调用（受权限控制）
  - 服务端插件：domain 校验、规范化、落库扩展、索引/摘要生成、与外部系统集成
- 插件作用域：按 `server_socket` 隔离（见 `design/decisions/ADR-0001-plugin-scope-and-gate.md`）

## 基本概念
- `plugin_id`：插件唯一标识
- `domain` / `domain_version`：消息类型标识与契约版本
- Contract：domain 的 schema 与约束

## 关键流程（高层）
1) 客户端连接服务器 → 拉取插件目录与 required
2) 若缺 required：进入安装向导（允许下载/安装/启用，但禁止登录）
3) 登录后：频道/消息正常工作；未装某 domain 插件时按降级策略展示
4) 已装插件时：可使用 composer 发送自定义 domain；服务端插件负责校验与处理

## 开放问题（待补齐）
- 插件包结构（ESM 目录结构、资源引用方式、版本与依赖）
- 插件更新/回滚策略
- 插件信任与签名（规划项）

