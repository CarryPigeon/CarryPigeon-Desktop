# ADR-0001：插件作用域与 Required Gate

日期：2026-01-31  
状态：Accepted

## 背景
项目目标是“自建服务器聊天客户端”，并以插件实现垂直场景能力。需明确插件的隔离边界与 required 插件的生效方式。

## 决策
1) 插件作用域为 **server_socket 级**：
   - 插件安装/启用/版本/数据缓存按 `server_socket` 隔离。
   - 同一服务器下所有频道共享同一套插件。

补充（实现约定）：
- 客户端本地目录/缓存隔离键使用 `server_id`（服务端返回固定 UUID），以保证跨设备一致性与可迁移性。

2) 频道不对插件作约束：
   - 不存在 channel required。
   - 未安装某 domain 插件时，频道仍可进入，消息按降级策略展示。

3) 服务端可声明 **server required 插件**，且 **未满足时阻止登录**：
   - 允许握手、获取服务器信息、获取插件目录、下载/安装/启用插件。
   - 禁止注册/登录/token-login 等登录相关能力，直到 required 插件满足。

## 影响
- 客户端必须在登录前执行“required 检查与安装向导”。
- 服务端需要为“required 未满足”提供稳定可识别的错误响应（见后续协议文档）。

## 迁移/兼容
- 后续引入签名/信任体系时，不改变本 ADR 的作用域与 gate 语义。
